Feature: 策略運行器整合 (Strategy Runner Integration)
  為了 將底層數據流轉化為實際的交易指令
  作為 系統架構師
  我要求 運行器能正確串接 Ring Buffer、SBE Decoder、Signal 與 Strategy Engine，形成完整的事件迴圈。

  # ---------------------------------------------------------------------------
  # 背景：組件模擬與環境準備
  # ---------------------------------------------------------------------------
  Background: 整合環境初始化
    Given 共享記憶體 Ring Buffer 已建立並寫入模擬數據
    And 策略配置為: ChaseThreshold=2.0, MaxChaseRound=3
    And 一個 Mock Gateway 已準備好接收訂單指令

  # ---------------------------------------------------------------------------
  # 場景 1: 完整的 Tick-to-Order 流程 (The Golden Path)
  # ---------------------------------------------------------------------------
  Scenario: 市場數據觸發追價指令
    Given Ring Buffer 推送了一個價格飆漲的 SBE 封包 (Price=105.0)
    And 上一時刻價格為 100.0
    And OFI 信號計算結果為 +10
    When 運行器執行一次迴圈
    Then 運行器應從 Ring Buffer 讀取到數據
    And SBE 解碼器應解析出 Price=105.0
    And OFI 計算器應更新狀態
    And 策略引擎應生成 `CancelReplaceRequest(Price=105.0)`
    And Mock Gateway 應收到該訂單請求

  # ---------------------------------------------------------------------------
  # 場景 2: 靜默處理 (Silence Processing)
  # ---------------------------------------------------------------------------
  Scenario: 市場波動不足，策略保持靜默
    Given Ring Buffer 推送了一個微幅波動的 SBE 封包 (Price=100.1)
    When 運行器執行一次迴圈
    Then OFI 計算器應更新
    But 策略引擎不應生成訂單指令
    And Mock Gateway 收到的指令列表應為空

  # ---------------------------------------------------------------------------
  # 場景 3: 異常數據恢復 (Resilience)
  # ---------------------------------------------------------------------------
  Scenario: 處理無效的 SBE 數據
    Given Ring Buffer 中出現無法解析的垃圾數據
    When 運行器嘗試執行迴圈
    Then 系統應捕獲 `SBEDecodeError`
    And 系統應記錄錯誤日誌 "Invalid Market Data"
    And 運行器不應崩潰
    And 策略狀態機應保持不變

  # ---------------------------------------------------------------------------
  # 場景 4: 延遲監控 (Latency Monitoring)
  # ---------------------------------------------------------------------------
  Scenario: 測量處理延遲
    Given 系統已啟用延遲監控
    When 運行器完成一次產生訂單的迴圈
    Then 系統應記錄 "TickProcessingTime" 指標
