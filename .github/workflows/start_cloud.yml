name: Start Shijim Cloud

on:
  schedule:
    # UTC 時間 00:25 = 台灣時間 08:25
    # 週一到週五執行
    - cron: '25 0 * * 1-5'
  workflow_dispatch: # 允許手動按鈕觸發

jobs:
  start-services:
    runs-on: ubuntu-latest
    steps:
    - name: Azure Login
      uses: azure/login@v2
      with:
        # 請先在 GitHub Repository Settings -> Secrets 設定 AZURE_CREDENTIALS
        creds: ${{ secrets.AZURE_CREDENTIALS }}

    - name: Install Azure Container Apps Extension
      run: az extension add --name containerapp --upgrade

    - name: Start ClickHouse
      run: |
        az containerapp update --name clickhouse --resource-group shijim-rg --min-replicas 1 --max-replicas 1

    - name: Start Workers
      run: |
        for i in {0..4}; do
          az containerapp update --name "shijim-worker-$i" --resource-group shijim-rg --min-replicas 1 --max-replicas 1
        done